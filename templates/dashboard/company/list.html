{% extends 'dashboard/base.html' %}
{% load page_tags %}
{% load tz %}

{% block stage %}
<style>
    .company-manager {
        background: #f8fafc;
        min-height: 100%;
        padding: 56px 0 48px;
    }

    .company-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 24px;
        display: flex;
        flex-direction: column;
        gap: 28px;
    }

    .company-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 24px;
        align-items: flex-end;
    }

    .company-header__content span {
        display: inline-block;
        font-size: 0.75rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #64748b;
        margin-bottom: 6px;
    }

    .company-header__content h1 {
        margin: 0;
        font-size: 1.9rem;
        font-weight: 700;
        color: #0f172a;
    }

    .company-header__content p {
        margin: 10px 0 0;
        color: #475569;
        max-width: 640px;
        line-height: 1.5;
    }

    .company-status {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: flex-end;
    }

    .company-status__label {
        font-size: 0.8rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #64748b;
    }

    .company-status__filters {
        display: inline-flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .company-filter {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 18px;
        border-radius: 999px;
        border: 1px solid #d1d9e6;
        background: #ffffff;
        color: #1f2937;
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        transition: all 0.18s ease;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
    }

    .company-filter:hover {
        transform: translateY(-1px);
        border-color: #93c5fd;
        color: #1d4ed8;
    }

    .company-filter--active {
        background: linear-gradient(135deg, #2563eb, #1e40af);
        color: #ffffff;
        border-color: transparent;
        box-shadow: 0 12px 28px rgba(37, 99, 235, 0.32);
    }

    .company-header__actions {
        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: flex-end;
    }

    .company-add-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, #2563eb, #1e40af);
        color: #ffffff;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.18s ease;
        box-shadow: 0 14px 32px rgba(37, 99, 235, 0.32);
        text-decoration: none;
    }

    .company-add-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 36px rgba(37, 99, 235, 0.36);
        color: #ffffff;
    }

    .company-insights {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 16px;
    }

    .company-insights__card {
        background: #ffffff;
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        padding: 16px 20px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
    }

    .company-insights__label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #64748b;
    }

    .company-insights__value {
        font-size: 1.6rem;
        font-weight: 700;
        color: #1e293b;
    }

    .company-tools {
        display: grid;
        gap: 20px;
        background: #ffffff;
        border-radius: 20px;
        border: 1px solid #e2e8f0;
        box-shadow: 0 14px 32px rgba(15, 23, 42, 0.1);
        padding: 24px;
    }

    .company-form {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .company-form label {
        font-size: 0.78rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #64748b;
    }

    .company-form__fields {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
    }

    .company-form__fields input {
        flex: 1;
        min-width: 300px;
        border-radius: 12px;
        border: 1px solid #d1d9e6;
        background: #ffffff;
        padding: 12px 16px;
        font-size: 0.95rem;
        color: #0f172a;
        transition: border-color 0.18s ease, box-shadow 0.18s ease;
    }

    .company-form__fields input:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
        outline: none;
    }

    .company-form__fields button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 12px;
        padding: 12px 20px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.18s ease;
        white-space: nowrap;
        background: linear-gradient(135deg, #2563eb, #1e40af);
        color: #ffffff;
        box-shadow: 0 14px 32px rgba(37, 99, 235, 0.32);
    }

    .company-form__fields button:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 36px rgba(37, 99, 235, 0.36);
    }

    .company-status-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        font-size: 0.85rem;
        color: #64748b;
    }

    .company-status-legend__item {
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .company-status-legend__item i {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .company-status-legend__item.draft i { background: #f59e0b; }
    .company-status-legend__item.pending i { background: #3b82f6; }
    .company-status-legend__item.published i { background: #10b981; }
    .company-status-legend__item.live i { background: #059669; }
    .company-status-legend__item.deleted i { background: #ef4444; }

    .company-results {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        color: #475569;
        font-size: 0.95rem;
    }

    .company-results strong {
        color: #0f172a;
    }

    .company-results__reset {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        color: #2563eb;
        text-decoration: none;
    }

    .company-results__reset:hover {
        text-decoration: underline;
    }

    .company-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 20px;
    }

    .company-card {
        background: #ffffff;
        border-radius: 20px;
        border: 1px solid #e2e8f0;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 18px;
        box-shadow: 0 18px 32px rgba(15, 23, 42, 0.08);
    }

    .company-card__header {
        display: flex;
        gap: 16px;
        align-items: flex-start;
    }

    .company-card__logo {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        object-fit: cover;
        border: 1px solid #e2e8f0;
        flex-shrink: 0;
    }

    .company-card__logo-placeholder {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .company-card__identity {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        min-width: 0;
    }

    .company-card__title {
        margin: 0;
        font-size: 1.15rem;
        font-weight: 600;
        color: #0f172a;
        line-height: 1.35;
        word-break: break-word;
    }

    .company-card__website {
        font-size: 0.9rem;
        color: #2563eb;
        text-decoration: none;
        word-break: break-all;
    }

    .company-card__website:hover {
        text-decoration: underline;
    }

    .company-card__meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        font-size: 0.85rem;
        color: #64748b;
    }

    .company-card__meta span {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        background: #f1f5f9;
        color: #1d4ed8;
        font-weight: 500;
    }

    .company-card__meta .status-active {
        background: #ecfdf5;
        color: #047857;
    }

    .company-card__meta .status-inactive {
        background: #fef3c7;
        color: #d97706;
    }

    .company-card__stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 12px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
    }

    .company-stat {
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .company-stat__value {
        font-size: 1.2rem;
        font-weight: 700;
        color: #1e293b;
    }

    .company-stat__label {
        font-size: 0.75rem;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }

    .company-stat--draft .company-stat__value { color: #f59e0b; }
    .company-stat--pending .company-stat__value { color: #3b82f6; }
    .company-stat--published .company-stat__value { color: #10b981; }
    .company-stat--live .company-stat__value { color: #059669; }
    .company-stat--deleted .company-stat__value { color: #ef4444; }

    .company-card__actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .company-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        font-size: 0.8rem;
        font-weight: 500;
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid #d1d9e6;
        color: #1f2937;
        background: #ffffff;
        text-decoration: none;
        transition: all 0.18s ease;
        cursor: pointer;
        flex: 1 1 calc(25% - 8px);
        min-width: 80px;
    }

    .company-action:hover {
        transform: translateY(-1px);
        background: #f1f5f9;
    }

    .company-action--primary {
        background: #2563eb;
        color: #ffffff;
        border-color: #2563eb;
    }

    .company-action--primary:hover {
        background: #1e40af;
    }

    .company-action--success {
        background: #10b981;
        color: #ffffff;
        border-color: #10b981;
    }

    .company-action--success:hover {
        background: #059669;
    }

    .company-action--danger {
        background: #fee2e2;
        color: #b91c1c;
        border-color: #fecaca;
    }

    .company-action--danger:hover {
        background: #fecaca;
        color: #991b1b;
    }

    .company-action--warning {
        background: #fef3c7;
        color: #d97706;
        border-color: #fde68a;
    }

    .company-action--warning:hover {
        background: #fde68a;
        color: #b45309;
    }

    .company-empty {
        background: #ffffff;
        border-radius: 20px;
        border: 1px dashed #cbd5f5;
        padding: 60px 24px;
        text-align: center;
        color: #475569;
        display: grid;
        gap: 14px;
        justify-items: center;
        box-shadow: 0 18px 32px rgba(15, 23, 42, 0.08);
    }

    .company-empty i {
        font-size: 2.8rem;
        color: #2563eb;
    }

    .company-pagination {
        display: flex;
        justify-content: center;
    }

    .company-pagination__inner {
        background: #ffffff;
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
        padding: 12px 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
    }

    .company-pagination__group {
        display: inline-flex;
        gap: 12px;
        align-items: center;
    }

    .company-pagination__button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px 16px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        color: #1f2937;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        transition: all 0.18s ease;
    }

    .company-pagination__button:hover {
        background: #e2e8f0;
    }

    .company-pagination__button--primary {
        background: linear-gradient(135deg, #2563eb, #1e40af);
        color: #ffffff;
        border-color: transparent;
        box-shadow: 0 10px 24px rgba(37, 99, 235, 0.32);
    }

    .company-pagination__button--disabled {
        color: #94a3b8;
        background: #f8fafc;
        border-color: #e2e8f0;
        cursor: not-allowed;
        box-shadow: none;
    }

    @media (max-width: 960px) {
        .company-card__actions .company-action {
            flex: 1 1 calc(50% - 8px);
        }
    }

    @media (max-width: 768px) {
        .company-manager {
            padding: 40px 0 36px;
        }

        .company-container {
            padding: 0 18px;
            gap: 24px;
        }

        .company-header__content h1 {
            font-size: 1.6rem;
        }

        .company-status {
            align-items: flex-start;
        }

        .company-card {
            padding: 20px;
        }

        .company-card__header {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .company-card__actions {
            gap: 6px;
        }

        .company-card__actions .company-action {
            flex: 1 1 calc(50% - 6px);
        }

        .company-pagination__inner {
            flex-direction: column;
            align-items: stretch;
        }

        .company-pagination__group {
            justify-content: space-between;
        }
    }
</style>

<section class="company-manager" id="companies">
    <div class="company-container">
        <div class="company-header">
            <div class="company-header__content">
                <span>Company management</span>
                <h1>{% if company_type == 'company' %}Companies{% else %}Agencies{% endif %} directory</h1>
                <p>Manage {% if company_type == 'company' %}companies{% else %}agencies{% endif %} and their profiles. View company details, manage recruiters, job posts, and tickets from a centralized dashboard.</p>
            </div>
            <div class="company-header__actions">
    {% if company_type == 'company' %}
                    <a href="{% url 'dashboard:new_company' %}" class="company-add-button">
                        <i class="fa fa-plus"></i>
                        Add New Company
                    </a>
    {% endif %}
       </div>
    </div>

        <div class="company-status">
            <span class="company-status__label">Quick filter</span>
            <div class="company-status__filters">
                {% if company_type == 'company' %}
                    <a class="company-filter{% if status == 'true' or active == 'true' %} company-filter--active{% endif %}"
                       href="{% url 'dashboard:companies' 'company' %}?active=true">Active</a>
                    <a class="company-filter{% if status == 'false' or active == 'false' %} company-filter--active{% endif %}"
                       href="{% url 'dashboard:companies' 'company' %}?active=false">Inactive</a>
                {% else %}
                    <a class="company-filter{% if status == 'active' %} company-filter--active{% endif %}"
                       href="{% url 'dashboard:companies' 'consultant' %}?active=true">Active</a>
                    <a class="company-filter{% if status == 'inactive' %} company-filter--active{% endif %}"
                       href="{% url 'dashboard:companies' 'consultant' %}?active=false">Inactive</a>
                    <a class="company-filter{% if status == 'admin_active' %} company-filter--active{% endif %}"
                       href="{% url 'dashboard:companies' 'consultant' %}?admin=true">Active Agency Admins</a>
                    <a class="company-filter{% if status == 'admin_inactive' %} company-filter--active{% endif %}"
                       href="{% url 'dashboard:companies' 'consultant' %}?admin=false">Inactive Agency Admins</a>
    {% endif %}
            </div>
        </div>

        <div class="company-insights">
            <div class="company-insights__card">
                <span class="company-insights__label">Total {% if company_type == 'company' %}companies{% else %}agencies{% endif %}</span>
                <span class="company-insights__value">{{ companies|length }}</span>
                <small class="text-muted">on this page</small>
            </div>
            <div class="company-insights__card">
                <span class="company-insights__label">Current page</span>
                <span class="company-insights__value">{{ current_page }}</span>
                <small class="text-muted">of {{ last_page }}</small>
            </div>
            <div class="company-insights__card">
                <span class="company-insights__label">Status</span>
                <span class="company-insights__value">{{ status|capfirst }}</span>
                <small class="text-muted">filtered</small>
            </div>
        </div>

        <div class="company-tools">
            <form id="search_form" method="get" class="company-form">
                <label for="search">Search & Filter</label>
                <div class="company-form__fields">
                    <input type="text" name="search" id="search" 
                           value="{{ request.GET.search }}"
                           placeholder="Search by company name, website, or recruiter email...">
                    <input type="hidden" name="active" value="{{ request.GET.active }}">
                    <input type="hidden" name="admin" value="{{ request.GET.admin }}">
                    <input type="hidden" name="page" value="{% if page %}{{page}}{% else %}1{% endif %}">
                    <button type="submit">
                        <i class="fa fa-search"></i>
                        Search
                    </button>
                </div>
            </form>
            
            <div class="company-status-legend">
                <span class="company-status-legend__item draft">
                    <i></i>
                    Draft
                </span>
                <span class="company-status-legend__item pending">
                    <i></i>
                    Pending
                </span>
                <span class="company-status-legend__item published">
                    <i></i>
                    Published
                </span>
                <span class="company-status-legend__item live">
                    <i></i>
                    Live
                </span>
                <span class="company-status-legend__item deleted">
                    <i></i>
                    Deleted
                </span>
            </div>
        </div>

        <div class="company-results">
            <span>Showing <strong>{{ companies|length }}</strong> {% if company_type == 'company' %}companies{% else %}agencies{% endif %}
                {% if search_value %} · Matching "{{ search_value }}"{% endif %}
                {% if status %} · Status: <strong>{{ status|capfirst }}</strong>{% endif %}
            </span>
            {% if search_value %}
                <a class="company-results__reset" href="{% url 'dashboard:companies' company_type %}?{% if active %}active={{ active }}&{% endif %}{% if admin %}admin={{ admin }}&{% endif %}">
                    <i class="fa fa-rotate-left"></i>
                    Clear search
                </a>
            {% endif %}
      </div>

        {% if companies %}
            <div class="company-grid">
      {% for company in companies %}
        {% with company.get_company_admin as agency_admin %}
                    <article class="company-card">
                        <div class="company-card__header">
            {% if company.profile_pic %}
                                <img src="{{ company.profile_pic }}" alt="{{ company.name }}" class="company-card__logo">
                            {% else %}
                                <div class="company-card__logo-placeholder">
                                    <i class="fa fa-building"></i>
                                </div>
            {% endif %}
                            
                            <div class="company-card__identity">
                                <h2 class="company-card__title">
                                    <a href="{% url 'dashboard:view_company' company.id %}">{{ company.name }}</a>
                                </h2>
                                {% if company.website %}
                                    <a href="{{ company.website }}" target="_blank" class="company-card__website">{{ company.website }}</a>
                                {% else %}
                                    <span class="company-card__website">No website</span>
                                {% endif %}
                                
                                <div class="company-card__meta">
                                    <span class="{% if company.is_active %}status-active{% else %}status-inactive{% endif %}">
                                        <i class="fa fa-circle"></i>
                                        {% if company.is_active %}Active{% else %}Inactive{% endif %}
                                    </span>
                                    <span>
                                        <i class="fa fa-calendar"></i>
                                        {{ company.registered_date|date:"M d, Y" }}
                                    </span>
                                    {% if company.created_from %}
                                        <span>
                                            <i class="fa fa-plus"></i>
                                            {{ company.created_from }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="company-card__stats">
                            <div class="company-stat company-stat--draft">
                                <span class="company-stat__value">{{ company.get_total_jobposts|filter_jobposts:'Draft' }}</span>
                                <span class="company-stat__label">Draft</span>
                            </div>
                            <div class="company-stat company-stat--pending">
                                <span class="company-stat__value">{{ company.get_total_jobposts|filter_jobposts:'Pending' }}</span>
                                <span class="company-stat__label">Pending</span>
                            </div>
                            <div class="company-stat company-stat--published">
                                <span class="company-stat__value">{{ company.get_total_jobposts|filter_jobposts:'Published' }}</span>
                                <span class="company-stat__label">Published</span>
                            </div>
                            <div class="company-stat company-stat--live">
                                <span class="company-stat__value">{{ company.get_total_jobposts|filter_jobposts:'Live' }}</span>
                                <span class="company-stat__label">Live</span>
                            </div>
                            <div class="company-stat company-stat--deleted">
                                <span class="company-stat__value">{{ company.get_total_jobposts|filter_jobposts:'Disabled' }}</span>
                                <span class="company-stat__label">Deleted</span>
                            </div>
                        </div>

                        <div class="company-card__actions">
                            <a href="{% url 'dashboard:edit_company' company.id %}" class="company-action company-action--primary" title="Edit Company">
                                <i class="fa fa-edit"></i>
                                Edit
                            </a>

                            <a href="{% url 'dashboard:company_recruiters' company.id 'active' %}" class="company-action" title="View Recruiters">
                                <i class="fa fa-users"></i>
                                Recruiters
                            </a>

                            <a href="{% url 'dashboard:company_jobposts' company.id %}" class="company-action" title="View Job Posts">
                                <i class="fa fa-briefcase"></i>
                                Jobs
                            </a>

                            <a href="{% url 'dashboard:company_tickets' company.id %}" class="company-action" title="View Tickets">
                                <i class="fa fa-question"></i>
                                Tickets
                            </a>

            {% if company.is_active and company.slug %}
                                <a href="{% url 'company_jobs' company.slug %}" target="_blank" class="company-action company-action--success" title="View Company Frontend">
                                    <i class="fa fa-eye"></i>
                                    View
              </a>
            {% endif %}

                            <a href="#" data-href="{% url 'dashboard:enable_company' company.id %}?page={{ current_page }}" 
                               class="company-action {% if company.is_active %}company-action--warning{% else %}company-action--success{% endif %} enable_company" 
                               title="{% if company.is_active %}Deactivate{% else %}Activate{% endif %} Company">
                                <i class="fa {% if company.is_active %}fa-times{% else %}fa-check{% endif %}"></i>
                                {% if company.is_active %}Deactivate{% else %}Activate{% endif %}
                            </a>

                            <a href="#" data-href="{% url 'dashboard:delete_company' company.id %}" 
                               class="company-action company-action--danger delete-company" 
                               title="Delete Company">
                                <i class="fa fa-trash"></i>
                                Delete
                            </a>
                        </div>
                    </article>
        {% endwith %}
      {% endfor %}
            </div>
        {% else %}
            <div class="company-empty">
                <i class="fa-solid fa-building"></i>
                <p>No {% if company_type == 'company' %}companies{% else %}agencies{% endif %} found. Adjust your filters or search terms to see existing entries.</p>
            </div>
        {% endif %}

        {% if companies %}
            <div class="company-pagination">
                <div class="company-pagination__inner" aria-label="Companies pagination">
                    <div class="company-pagination__group">
                        {% if current_page > 1 %}
                            <a class="company-pagination__button company-pagination__button--primary"
                               href="?{% if admin %}admin={{ admin }}&{% endif %}{% if active %}active={{ active }}&{% endif %}{% if search_value %}search={{ search_value }}&{% endif %}page=1">&laquo;</a>
                            <a class="company-pagination__button"
                               href="?{% if admin %}admin={{ admin }}&{% endif %}{% if active %}active={{ active }}&{% endif %}{% if search_value %}search={{ search_value }}&{% endif %}page={{ prev_page }}">&lsaquo; Previous</a>
                        {% else %}
                            <span class="company-pagination__button company-pagination__button--disabled">&laquo;</span>
                            <span class="company-pagination__button company-pagination__button--disabled">&lsaquo; Previous</span>
              {% endif %}
                    </div>

                    <div class="company-pagination__group">
                        <span class="company-pagination__button" style="border: none; background: transparent; color: #1f2937;">Page {{ current_page }} of {{ last_page }}</span>
                    </div>

                    <div class="company-pagination__group">
                        {% if current_page < last_page %}
                            <a class="company-pagination__button"
                               href="?{% if admin %}admin={{ admin }}&{% endif %}{% if active %}active={{ active }}&{% endif %}{% if search_value %}search={{ search_value }}&{% endif %}page={{ aft_page }}">Next &rsaquo;</a>
                            <a class="company-pagination__button company-pagination__button--primary"
                               href="?{% if admin %}admin={{ admin }}&{% endif %}{% if active %}active={{ active }}&{% endif %}{% if search_value %}search={{ search_value }}&{% endif %}page={{ last_page }}">&raquo;</a>
                        {% else %}
                            <span class="company-pagination__button company-pagination__button--disabled">Next &rsaquo;</span>
                            <span class="company-pagination__button company-pagination__button--disabled">&raquo;</span>
              {% endif %}
                    </div>
      </div>
            </div>
        {% endif %}
  </div>
</section>

{% endblock stage %}

{% block script %}
    <script type="text/javascript">
    (function ($) {
        // Setup CSRF token for AJAX requests
        var csrfToken = $('[name=csrfmiddlewaretoken]').val();
        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                    xhr.setRequestHeader("X-CSRFToken", csrfToken);
                }
            }
        });

        // Handle delete company
        $(document).on('click', '.delete-company', function(e) {
            e.preventDefault();
          e.stopPropagation();
            
            if (!confirm('Do you want to delete this company?')) {
          return;
            }
            
            var href = $(this).attr('data-href');
            var search = $('#search').val();
            var page = $('#page').val();
            var admin = $('#admin').val();
            
            $.post(href, {
                'search': search, 
                'page': page, 
                'admin': admin
            }, function(data) {
                open_dialog("Company Deleted Successfully", 'Success');
                var url = data.url;
                  window.location = '.' + "?page=" + page + '&search=' + search + '&active=' + data.is_active + '&admin=' + admin;
          }, 'json');
        });

        // Handle enable/disable company
        $(document).on('click', '.enable_company', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var href = $(this).attr('data-href');
            var id = $(this).attr('id');
            var search = $('#search').val();
            var page = $('#page').val();
            var admin = $('#admin').val();
            
            $.post(href, {
                'search': search, 
                'page': page, 
                'admin': admin
            }, function(data) {
                if (data.error) {
                    open_dialog(data.response, 'Error!!');
                } else {
                    var url = data.url;
                  window.location = '.' + "?page=" + page + '&search=' + search + '&active=' + data.is_active + '&admin=' + admin;
                }
            }, 'json');
        });
    })(jQuery);
    </script>

{% endblock script %}